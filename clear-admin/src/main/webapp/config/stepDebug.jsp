<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%><!DOCTYPE html><!--[if IE 8]> <html lang="en" class="ie8"> <![endif]--><!--[if IE 9]> <html lang="en" class="ie9"> <![endif]--><!--[if !IE]><!--><html lang="en"><!--<![endif]--><!-- BEGIN HEAD --><head><meta charset="utf-8" /><title>SGE | 清算管理台</title><meta content="width=device-width, initial-scale=1.0" name="viewport" /><meta content="" name="description" /><meta content="" name="author" /><!-- BEGIN GLOBAL MANDATORY STYLES --><link href="<%=request.getContextPath()%>/media/css/bootstrap.min.css" rel="stylesheet"	type="text/css" /><link href="<%=request.getContextPath()%>/media/css/bootstrap-responsive.min.css" rel="stylesheet"	type="text/css" /><link href="<%=request.getContextPath()%>/media/css/font-awesome.min.css" rel="stylesheet"	type="text/css" /><link href="<%=request.getContextPath()%>/media/css/style-metro.css" rel="stylesheet" type="text/css" /><link href="<%=request.getContextPath()%>/media/css/style.css" rel="stylesheet" type="text/css" /><link href="<%=request.getContextPath()%>/media/css/style-responsive.css" rel="stylesheet" type="text/css" /><link href="<%=request.getContextPath()%>/media/css/default.css" rel="stylesheet" type="text/css" id="style_color" /><link href="<%=request.getContextPath()%>/media/css/uniform.default.css" rel="stylesheet" type="text/css" />	<link rel="stylesheet" type="text/css" href="<%=request.getContextPath()%>/media/css/jquery-ui.css" /><!-- END GLOBAL MANDATORY STYLES --><link rel="shortcut icon" href="<%=request.getContextPath()%>/media/image/favicon.ico" /></head><!-- END HEAD --><!-- BEGIN BODY --><body class="page-header-fixed" onload="flushInterval();">	<!-- BEGIN HEADER -->	<%@ include file="../layout/_header.jsp" %>	<!-- END HEADER -->		<!-- BEGIN CONTAINER -->	<div class="page-container row-fluid">		<!-- BEGIN SIDEBAR -->				<%@ include file="../layout/_menu.jsp" %>				<!-- END SIDEBAR -->		<!-- BEGIN PAGE -->		<div class="page-content">			<!-- BEGIN SAMPLE PORTLET CONFIGURATION MODAL FORM-->			<!-- END SAMPLE PORTLET CONFIGURATION MODAL FORM-->			<!-- BEGIN PAGE CONTAINER-->			<div class="container-fluid">				<!-- BEGIN PAGE HEADER-->				<div class="row-fluid">					<div class="span12">						<!-- BEGIN STYLE CUSTOMIZER -->						<!-- END BEGIN STYLE CUSTOMIZER -->						<!-- BEGIN PAGE TITLE & BREADCRUMB-->						<h3 class="page-title">							单步流程测试 <small>One-Step Process Test</small>						</h3>						<ul class="breadcrumb">							<li><i class="icon-home"></i> <a href="<%=request.getContextPath()%>/admin/admin.jsp">首页</a> <i								class="icon-angle-right"></i></li>							<li><a href="<%=request.getContextPath()%>/config/stepConfig.jsp">清算流程管理</a> <i class="icon-angle-right"></i></li>							<li><a href="#">单步流程测试</a></li>						</ul>						<!-- END PAGE TITLE & BREADCRUMB-->					</div>				</div>				<!-- END PAGE HEADER-->				<!-- BEGIN PAGE CONTENT-->				<div class="row-fluid">					<label class="control-label">请选择日期 :</label> 					<input id="datepicker" class="m-wrap small" type="text" value="" size="16" placeholder="请选择清算日期"> 				</div>								<div class="portlet">					<div class="portlet-title">						<div class="caption">							<i class="icon-bar-chart"></i>清算单步测试						</div>						<div class="tools">							<a href="javascript:;" class="collapse"></a> 							<a onclick="flushResult();" class="reload"></a> 							<a href="javascript:;"								class="remove"></a>						</div>					</div>					<div class="portlet-body">						<table							class="table table-striped table-bordered table-advance table-hover">							<thead>								<tr>									<th>场次号</th>									<th>场次名称</th>									<th>应用路径</th>																		<th>备注</th>																		<th>操作</th>																		<th>场次状态</th>									<th>应用日志</th>																		<th>查看日志</th>																	</tr>							</thead>							<tbody id="resultTable">							</tbody>						</table>					</div>				</div>				<!-- END SAMPLE TABLE PORTLET-->				<div class="portlet-title">					<div class="caption">						<i class="icon-comments"></i>单步执行日志明细:					</div>				</div>				<div id="taskLog" class="alert alert-success"></div>				<div class="portlet-title">					<div id="stepLogTitle" class="caption">						<i class="icon-comments"></i>清算步骤日志明细					</div>				</div>				<div id="stepLog" class="alert alert-info"></div>				<!-- END PAGE CONTENT-->			</div>			<!-- END PAGE CONTAINER-->		</div>		<!-- END PAGE -->	</div>	<!-- END CONTAINER -->	<!-- BEGIN FOOTER -->		<%@ include file="../layout/_footer.jsp" %>		<!-- END FOOTER -->	<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->	<!-- BEGIN CORE PLUGINS -->	<script src="<%=request.getContextPath()%>/media/js/jquery-1.10.1.min.js" type="text/javascript"></script>	<script src="<%=request.getContextPath()%>/media/js/jquery-migrate-1.2.1.min.js"		type="text/javascript"></script>	<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->	<script src="<%=request.getContextPath()%>/media/js/jquery-ui-1.10.1.custom.min.js"		type="text/javascript"></script>	<script src="<%=request.getContextPath()%>/media/js/bootstrap.min.js" type="text/javascript"></script>	<!--[if lt IE 9]>
	<script src="<%=request.getContextPath()%>/media/js/excanvas.min.js"></script>
	<script src="<%=request.getContextPath()%>/media/js/respond.min.js"></script>  
	<![endif]-->	<script src="<%=request.getContextPath()%>/media/js/jquery.slimscroll.min.js" type="text/javascript"></script>	<script src="<%=request.getContextPath()%>/media/js/jquery.blockui.min.js" type="text/javascript"></script>	<script src="<%=request.getContextPath()%>/media/js/jquery.cookie.min.js" type="text/javascript"></script>	<script src="<%=request.getContextPath()%>/media/js/jquery.uniform.min.js" type="text/javascript"></script>		<script type='text/javascript' src="/clear-admin/dwr/engine.js"></script>	<script type='text/javascript' src="/clear-admin/dwr/interface/AjaxStepDebugService.js"></script>	<script type='text/javascript' src="/clear-admin/dwr/util.js"></script> 		<script type="text/javascript">		function flushInterval(){		AjaxStepDebugService.loadStep(updateTable);	}   		function ContStep(step){		var clearDate = document.getElementById("datepicker").value;		if(clearDate==null || clearDate==""){			alert("请选择清算日期");		}		else{			timeId = setInterval(flushResult,500);			AjaxStepDebugService.runStep(clearDate,step,updateTable);			AjaxStepDebugService.getTaskLog(updateTaskLog);		}	} 		function flushResult(){		AjaxStepDebugService.getStepStatus(updateTable);		AjaxStepDebugService.getTaskLog(updateTaskLog);	} 		function viewLog(step,lines){		var clearDate = document.getElementById("datepicker").value;		if(clearDate==null || clearDate==""){			alert("请选择清算日期");		}		else{			AjaxStepDebugService.getStepLog(clearDate,step,lines,updateStepLog);		}	} 	    function updateTable(results){    	var cellFuncs = [    	function(data) {return data.step;},    	function(data) {return data.name;},    	function(data) {return data.url;},    	function(data) {return data.comt;},    	function(data) {    	  	if(data.status=="Runing")      			return "<span class=\"label label-info\">执行中...</span>";    		return "<a onclick=\"ContStep("+ data.step +");\" class=\"label label-important\">执行此模块</a>";    	  },     	function(data) {    	  	if(data.status=="Waiting")    			return "<span class=\"label label-warning\">等待执行</span>";    	  	if(data.status=="Runing")      			return "<span class=\"label label-info\">执行中...</span>";    	  	if(data.status=="Success")      			return "<span class=\"label label-success\">执行成功</span>";    	  	if(data.status=="Fail")    	  		return "<span class=\"label label-inverse\">执行失败</span>";            if(data.status=="Cancel")                return "<span class=\"label\">取消</span>";      			    	  return "<span class=\"label label-inverse\">未知</span>";},    	       	function(data) {return data.logfile;},    	function(data) {    		if(data.status=="Waiting")    			return "<span class=\"label label-danger\">Waiting</span>";    		    		return "<a onclick=\"viewLog(" +  data.step + ",50);\" class=\"btn mini green-stripe\">View</a>";    		},    	];    	    	DWRUtil.removeAllRows("resultTable");    	DWRUtil.addRows("resultTable",results,cellFuncs,{escapeHtml:false}); 	    }          function updateTaskLog(results){    	DWRUtil.setValue("taskLog",results.replace(/\r/ig, "<BR />").replace(/\n/ig, "<BR />"),{escapeHtml:false});//    	if(results.indexOf("StepFinished")>0)          //根据日志内容判断是否执行结束，从而关闭自动刷新//    		window.clearInterval(timeId);    }          function updateStepLog(results){    	DWRUtil.setValue("stepLog",results.replace(/\r/ig, "<BR />").replace(/\n/ig, "<BR />"),{escapeHtml:false});    }  </script> 	<!-- END CORE PLUGINS -->	<script src="<%=request.getContextPath()%>/media/js/app.js"></script>	<script>		$(function() {			$("#datepicker").datepicker({				dateFormat : 'yymmdd',				altField : "#alternate"			});		});	</script>	<script>
		jQuery(document).ready(function() {    
		   App.init();
		});
	</script>	<!-- END JAVASCRIPTS -->	<script type="text/javascript">  var _gaq = _gaq || [];  _gaq.push(['_setAccount', 'UA-37564768-1']);  _gaq.push(['_setDomainName', 'keenthemes.com']);  _gaq.push(['_setAllowLinker', true]);  _gaq.push(['_trackPageview']);  (function() {    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;    ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);  })();</script>	</body><!-- END BODY --></html>